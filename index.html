<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flipbook Godišnjaka 2016-2025 - IDSS</title>

<!-- jQuery i Turn.js CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>

<style>
  /* Reset i body */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f7;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  h1 {
    margin: 24px 0 12px;
    font-weight: 700;
    color: #2c3e50;
  }
  #loadingBox {
    width: 800px;
    max-width: 95vw;
    margin: 1rem auto;
    text-align: center;
  }
  #loadingText {
    font-size: 18px;
    color: #007bff;
    margin-bottom: 8px;
  }
  #progressBarContainer {
    width: 100%;
    height: 18px;
    background: #ddd;
    border-radius: 9px;
    overflow: hidden;
    margin-bottom: 8px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  }
  #progressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #0056b3, #3399ff);
    transition: width 0.3s ease;
  }
  #loadedCount {
    font-weight: 600;
    color: #444;
  }

  #flipbook {
    width: 800px;
    max-width: 95vw;
    height: 1131px;
    margin: 2rem auto 1.5rem;
    box-shadow: 0 0 30px rgba(0,0,0,0.2);
    background: white;
    border-radius: 4px;
  }
  #flipbook .page {
    background: white;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
    display: flex !important;
    justify-content: center;
    align-items: center;
  }
  #flipbook .page img {
    width: 100%;
    height: auto;
    max-height: 1131px;
    object-fit: contain;
  }
  .hard {
    background: #eee !important;
    color: #333;
    font-size: 24px;
    text-align: center;
    padding-top: 450px;
  }

  #controls {
    width: 800px;
    max-width: 95vw;
    margin: 0 auto 3rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  #controls button {
    background-color: #007bff;
    border: none;
    padding: 12px 22px;
    border-radius: 4px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    font-weight: 600;
    user-select: none;
    transition: background-color 0.25s ease;
  }
  #controls button:hover {
    background-color: #0056b3;
  }
  #pageIndicator {
    align-self: center;
    font-weight: 600;
    font-size: 18px;
    color: #555;
    user-select: none;
  }

  /* Responsive */
  @media (max-width: 850px) {
    #flipbook {
      height: calc(800 * 1.414); /* A4 ratio scaled */
    }
  }

  /* Keyboard hint */
  #hint {
    font-size: 14px;
    color: #666;
    margin-bottom: 24px;
    user-select: none;
  }
</style>
</head>
<body>

<h1>Flipbook Godišnjaka 2016-2025 - IDSS</h1>

<div id="loadingBox" aria-live="polite" aria-busy="true">
  <div id="loadingText">Učitavanje slika, molim pričekajte...</div>
  <div id="progressBarContainer" aria-label="Napredak učitavanja">
    <div id="progressBar"></div>
  </div>
  <div id="loadedCount">0 / 0</div>
</div>

<div id="flipbook" style="display:none;"></div>

<div id="controls" style="display:none;" role="group" aria-label="Kontrole flipbooka">
  <button id="prevPage" aria-label="Prethodna stranica">Prethodna stranica</button>
  <div id="pageIndicator" aria-live="polite" aria-atomic="true" aria-relevant="text">1 / 24</div>
  <button id="nextPage" aria-label="Sljedeća stranica">Sljedeća stranica</button>
</div>

<div id="hint" aria-hidden="true">Tipke ← i → za navigaciju, P za fullscreen, F za preuzimanje PDF</div>

<script>
  (function($) {
    // Slike (Imgur linkovi)
    const images = [
      "https://i.imgur.com/bFZhsvg.jpeg",
      "https://i.imgur.com/S10UScm.jpeg",
      "https://i.imgur.com/LcGyY3F.jpeg",
      "https://i.imgur.com/bsINYxk.jpeg",
      "https://i.imgur.com/Peee2wx.jpeg",
      "https://i.imgur.com/Q8ThB1H.jpeg",
      "https://i.imgur.com/bUVOUK2.jpeg",
      "https://i.imgur.com/hgHIeyM.jpeg",
      "https://i.imgur.com/PCeM1Ez.jpeg",
      "https://i.imgur.com/1cASFtz.jpeg",
      "https://i.imgur.com/vtTH7Ym.jpeg",
      "https://i.imgur.com/j3QnSYs.jpeg",
      "https://i.imgur.com/nii6vMk.png",
      "https://i.imgur.com/151s4ek.png",
      "https://i.imgur.com/2DgcdNg.jpeg",
      "https://i.imgur.com/nqG6R76.jpeg",
      "https://i.imgur.com/AFX4Axa.jpeg",
      "https://i.imgur.com/z1UJ0pq.jpeg",
      "https://i.imgur.com/EhD610r.jpeg",
      "https://i.imgur.com/xSlrz4m.png",
      "https://i.imgur.com/6oBDOb9.jpeg",
      "https://i.imgur.com/07R6EqR.jpeg",
      "https://i.imgur.com/d0CEELJ.jpeg",
      "https://i.imgur.com/rIS5qpZ.jpeg"
    ];

    let loadedCount = 0;
    const totalImages = images.length;

    const loadingBox = document.getElementById('loadingBox');
    const progressBar = document.getElementById('progressBar');
    const loadedCountEl = document.getElementById('loadedCount');
    const flipbook = $('#flipbook');
    const controls = $('#controls');
    const pageIndicator = document.getElementById('pageIndicator');

    // Puni flipbook sa stranicama
    function buildFlipbookPages(){
      flipbook.empty();
      for(let i=0; i < images.length; i++){
        const isHard = (i === 0 || i === images.length -1);
        const pageDiv = $('<div>').addClass('page');
        if(isHard) pageDiv.addClass('hard');
        const img = $('<img>').attr('src', images[i]).attr('alt', `Stranica ${i+1}`);
        pageDiv.append(img);
        flipbook.append(pageDiv);
      }
    }

    // Inicijalizacija turn.js
    function initFlipbook(){
      buildFlipbookPages();
      flipbook.turn({
        width: 800,
        height: 1131,
        autoCenter: true,
        display: 'double',
        acceleration: true,
        gradients: true,
        elevation: 50,
        duration: 800,
        when: {
          turning: function(e, page, view) {
            pageIndicator.textContent = page + " / " + totalImages;
          }
        }
      });
      loadingBox.style.display = 'none';
      flipbook.show();
      controls.show();
      // Prikaz prve stranice
      pageIndicator.textContent = "1 / " + totalImages;
    }

    // Preload slika sa progresom
    function preloadImages(urls, onComplete){
      if(urls.length === 0){
        onComplete();
        return;
      }
      urls.forEach(url => {
        const img = new Image();
        img.onload = () => {
          loadedCount++;
          updateProgress();
          if(loadedCount === totalImages) onComplete();
        };
        img.onerror = () => {
          loadedCount++;
          updateProgress();
          console.warn('Neuspjelo učitavanje slike:', url);
          if(loadedCount === totalImages) onComplete();
        };
        img.src = url;
      });
    }

    function updateProgress(){
      const pct = Math.round((loadedCount / totalImages)*100);
      progressBar.style.width = pct + '%';
      loadedCountEl.textContent = `${loadedCount} / ${totalImages}`;
    }

    // Navigacija tipkama
    function setupKeyboardNav(){
      document.addEventListener('keydown', e => {
        if(!flipbook.data('turn')) return;
        switch(e.key){
          case 'ArrowLeft':
            flipbook.turn('previous');
            break;
          case 'ArrowRight':
            flipbook.turn('next');
            break;
          case 'p':
          case 'P':
            toggleFullscreen();
            break;
          case 'f':
          case 'F':
            downloadPDF();
            break;
        }
      });
    }

    // Fullscreen toggle (modern browsers)
    function toggleFullscreen(){
      if(!document.fullscreenElement){
        document.documentElement.requestFullscreen().catch(e => console.warn(e));
      } else {
        document.exitFullscreen().catch(e => console.warn(e));
      }
    }

    // Dummy downloadPDF (mogu dodati pravu PDF funkcionalnost ako želiš)
    function downloadPDF(){
      alert("Funkcionalnost preuzimanja PDF trenutno nije dostupna, ali planirana je za budućnost.");
    }

    // Pokretanje
    preloadImages(images, initFlipbook);
    setupKeyboardNav();

  })(jQuery);
</script>

</body>
</html>